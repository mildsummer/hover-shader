<!DOCTYPE html>
<html>
<head>
    <title>PixiJS Shaders</title>
    <style type="text/css">
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<script type="text/javascript" src="https://cdn.jsdelivr.net/pixi.js/4.3.0/pixi.min.js"></script>
<script id="fShader" type="shader-code">
const int wave_length = 2;
precision mediump float;
varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float time;
uniform vec2 center_array[wave_length];

float sech(float x) {
  return 2.0 / (exp(x) + exp(-x));
}

void main(void) {
    vec2 offset = vec2(0.0, 0.0);
    for (int i = 0; i < wave_length; i++) {
        vec2 center = center_array[i];
        float distance = length(center - vTextureCoord);
        float x = distance * 10.0 - (time / 4000.0) * 40.0;
        float theta = cos(x) * sech(x) * sech(x);
        theta /= 20.0;
        vec2 v0 = center;
        vec2 v1 = vec2(v0.x * cos(theta) - v0.y * sin(theta), v0.x * sin(theta) + v0.y * cos(theta));
        offset += vec2(v1 - center);
    }
    vec4 pixel = texture2D(uSampler, vTextureCoord + offset);
    float offsetLength = length(offset);
    pixel.r += offsetLength * 1.8;
    pixel.g += offsetLength * 1.8;
    pixel.b += offsetLength * 1.8;
    gl_FragColor = pixel;
}
</script>

<script type="text/javascript">
    //Adapted from: http://codepen.io/davidhartley/pen/seEki?editors=0010

    var width = window.innerWidth;
    var height = window.innerHeight;
    var renderer = new PIXI.autoDetectRenderer(width, height);//Chooses either WebGL if supported or falls back to Canvas rendering
    document.body.appendChild(renderer.view);//Add the render view object into the page

    var stage = new PIXI.Container();//The stage is the root container that will hold everything in our scene

    // smoke shader
    var uniforms = {};
    uniforms.time = 0;
    uniforms.center_array = {
        type: '2fv',
        value: [0.5, 0.5, 0.1, 0.5]
    };

    var fShaderCode = document.getElementById( 'fShader' ).innerHTML;
    var smokeShader = new PIXI.Filter(null, fShaderCode, uniforms);

    var bg = PIXI.Sprite.fromImage('image.png');
    bg.width = width;
    bg.height = height;
    bg.filters = [smokeShader];
    stage.addChild(bg);
    var count = 0;
    animate();
    function animate() {

        count += (1000/60);

        smokeShader.uniforms.time = count;

        // this is the main render call that makes pixi draw your container and its children.
        renderer.render(stage);

        // start the timer for the next animation loop
        if (count < 4000) {
            requestAnimationFrame(animate);
        }
    }


</script>
</body>
</html>